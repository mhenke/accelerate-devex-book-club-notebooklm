name: CI

on: [push, pull_request]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.3'
          bundler-cache: true
          working-directory: 'docs'

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Node dependencies
        run: npm ci || npm install

      - name: Install Ruby gems
        run: |
          cd docs
          bundle install

      - name: Run Linters (CSS, Markdown, JS)
        run: |
          npm run lint:css
          npm run lint:md
          npm run lint:js

      - name: Check Spelling
        uses: rojopolis/spellcheck-github-actions@0.36.0
        with:
          source_files: |
            docs/_posts/**/*.md
            docs/_pages/**/*.md
            docs/_meetings/**/*.md
            docs/index.md
            README.md
          config_path: .spellcheck.yml

      - name: Run Jekyll Build
        run: npm run build

      - name: Run HTML Validation
        run: npm run test:html

      - name: Run HTML Proofer (Links, Images)
        run: |
          cd docs
          bundle exec htmlproofer ./_site --config-file ../.htmlproofer.yml

      - name: Run Jekyll Audit (Accessibility, Performance, SEO)
        run: npm run test:jekyll-audit