<!-- Simple Unified Checkpoint Component -->
<!-- 
Usage: Single component for all checkpoint types - passes in all data needed
Parameters:
- title: Checkpoint title (required)
- icon: FontAwesome icon class (optional)
- question: Question text (optional)  
- type: "radio", "slider", or "checkbox" (default: "radio")
- options: Array of option objects with text, value, performance_class, feedback_title, feedback_content
- radio_name: Name for radio buttons (required for radio type)
- feedback_id: ID for feedback area (required)
- default_feedback: Default feedback text (optional)
- slider_labels: Pipe-separated labels for slider (e.g. "Low|Medium|High")
-->

<div class="simple-checkpoint {{ include.type | default: 'radio' }}-checkpoint" markdown="0">
  <h4>
    {% if include.icon %}<i class="{{ include.icon }}"></i>{% endif %}
    {{ include.title }}
  </h4>
  {% if include.question %}<p>{{ include.question }}</p>{% endif %}

  {% if include.type == "slider" %}
    <!-- Slider Implementation -->
    <div class="slider-container" markdown="0">
      {% if include.slider_labels %}
        {% assign labels = include.slider_labels | split: '|' %}
        <div class="slider-labels" markdown="0">
          {% for label in labels %}
            <span>{{ label | strip }}</span>
          {% endfor %}
        </div>
      {% endif %}
      <div class="slider-track" markdown="0">
        <div class="slider-thumb" data-feedback-id="{{ include.feedback_id }}"></div>
      </div>
    </div>
  {% elsif include.type == "checkbox" %}
    <!-- Checkbox Implementation -->
    <div class="checkbox-grid" markdown="0">
      {% for option in include.options %}
        <label class="checkbox-item">
          <input type="checkbox" 
                 name="{{ include.radio_name }}" 
                 value="{{ option.value }}"
                 data-feedback-content="{{ option.feedback_content }}">
          <span class="checkbox-mark"></span>
          {{ option.text }}
        </label>
      {% endfor %}
    </div>
  {% else %}
    <!-- Radio Implementation -->
    <div class="option-buttons" markdown="0">
      {% for option in include.options %}
        <label class="option-btn {{ option.performance_class | default: 'performance-medium' }}">
          <input type="radio" 
                 name="{{ include.radio_name }}" 
                 value="{{ option.value }}"
                 data-feedback-title="{{ option.feedback_title }}"
                 data-feedback-content="{{ option.feedback_content }}">
          <span class="radio-mark"></span>
          {{ option.text }}
        </label>
      {% endfor %}
    </div>
  {% endif %}

  <div class="feedback-area" id="{{ include.feedback_id }}">
    <p>{{ include.default_feedback | default: 'Make a selection to see feedback.' }}</p>
  </div>
</div>

<style>
.simple-checkpoint {
  background: white;
  border-radius: 16px;
  padding: 1.5rem;
  margin-bottom: 2rem;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
  border-left: 4px solid #1E3A8A;
  transition: all 0.3s ease;
}

.simple-checkpoint:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

.simple-checkpoint h4 {
  margin: 0 0 1rem 0;
  color: #1e40af;
  font-size: 1.3rem;
  font-weight: 600;
}

.simple-checkpoint h4 i {
  margin-right: 0.5rem;
}

.simple-checkpoint p {
  color: #666;
  margin-bottom: 1.5rem;
  font-size: 0.95rem;
}

/* Radio Options */
.option-buttons {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
}

.option-btn {
  position: relative;
  display: flex;
  align-items: center;
  padding: 1rem;
  background: white;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 500;
  line-height: 1.4;
  min-height: 48px;
}

.option-btn:hover {
  border-color: #cbd5e1;
  transform: translateX(4px);
}

.option-btn input[type="radio"] {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

.option-btn .radio-mark {
  width: 20px;
  height: 20px;
  border: 2px solid #cbd5e1;
  border-radius: 50%;
  margin-right: 1rem;
  position: relative;
  flex-shrink: 0;
  transition: all 0.3s ease;
}

.option-btn input[type="radio"]:checked + .radio-mark {
  border-color: #1e40af;
  background: #1e40af;
}

.option-btn input[type="radio"]:checked + .radio-mark::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
  transform: translate(-50%, -50%);
}

/* Performance level colors when selected */
.option-btn.performance-high input[type="radio"]:checked + .radio-mark {
  border-color: #16a34a;
  background: #16a34a;
}

.option-btn.performance-medium input[type="radio"]:checked + .radio-mark {
  border-color: #d97706;
  background: #d97706;
}

.option-btn.performance-low input[type="radio"]:checked + .radio-mark {
  border-color: #dc2626;
  background: #dc2626;
}

/* Checkbox Grid */
.checkbox-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.checkbox-item {
  position: relative;
  display: flex;
  align-items: flex-start;
  padding: 1rem;
  background: white;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 500;
  line-height: 1.4;
  min-height: 48px;
}

.checkbox-item:hover {
  border-color: #cbd5e1;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.checkbox-item input[type="checkbox"] {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

.checkbox-item .checkbox-mark {
  width: 20px;
  height: 20px;
  border: 2px solid #cbd5e1;
  border-radius: 4px;
  margin-right: 1rem;
  position: relative;
  flex-shrink: 0;
  transition: all 0.3s ease;
  background: white;
}

.checkbox-item input[type="checkbox"]:checked + .checkbox-mark {
  border-color: #1e40af;
  background: #1e40af;
}

.checkbox-item input[type="checkbox"]:checked + .checkbox-mark::after {
  content: 'âœ“';
  position: absolute;
  top: 50%;
  left: 50%;
  color: white;
  font-size: 12px;
  font-weight: bold;
  transform: translate(-50%, -50%);
}

.checkbox-item:has(input[type="checkbox"]:checked) {
  border-color: #1e40af;
  background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
}

/* Slider */
.slider-container {
  margin: 1.5rem 0;
}

.slider-labels {
  display: flex;
  justify-content: space-between;
  margin-bottom: 1rem;
  font-size: 0.85rem;
  color: #666;
  font-weight: 500;
}

.slider-track {
  position: relative;
  height: 6px;
  background: #e0e0e0;
  border-radius: 3px;
  cursor: pointer;
}

.slider-thumb {
  position: absolute;
  top: -8px;
  left: 0;
  width: 22px;
  height: 22px;
  background: white;
  border: 3px solid #1E3A8A;
  border-radius: 50%;
  cursor: grab;
  transition: border-color 0.3s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.slider-thumb:active {
  cursor: grabbing;
}

/* Feedback */
.feedback-area {
  margin-top: 1.5rem;
  padding: 1rem;
  background: #f8f9fa;
  border-left: 4px solid #1E3A8A;
  border-radius: 8px;
  min-height: 60px;
  transition: all 0.3s ease;
}

.feedback-area.active {
  background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
}

.feedback-area h5 {
  margin: 0 0 0.5rem 0;
  color: #1e40af;
  font-size: 1rem;
  font-weight: 600;
}

.feedback-area p {
  margin: 0;
  font-size: 0.9rem;
  line-height: 1.4;
}

/* Responsive */
@media (max-width: 768px) {
  .simple-checkpoint {
    padding: 1.25rem;
  }
  
  .option-btn {
    padding: 0.75rem;
  }
  
  .option-btn .radio-mark {
    width: 18px;
    height: 18px;
    margin-right: 0.75rem;
  }
  
  .checkbox-grid {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }
  
  .checkbox-item {
    padding: 0.75rem;
  }
  
  .checkbox-item .checkbox-mark {
    width: 18px;
    height: 18px;
    margin-right: 0.75rem;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Handle radio button interactions
  document.querySelectorAll('.simple-checkpoint input[type="radio"]').forEach(input => {
    input.addEventListener('change', function() {
      const feedbackArea = document.getElementById(this.closest('.simple-checkpoint').querySelector('.feedback-area').id);
      const feedbackTitle = this.dataset.feedbackTitle;
      const feedbackContent = this.dataset.feedbackContent;
      
      if (feedbackArea && (feedbackTitle || feedbackContent)) {
        feedbackArea.classList.add('active');
        
        // Get performance level for styling
        const performanceClass = Array.from(this.closest('.option-btn').classList).find(cls => cls.startsWith('performance-'));
        let borderColor = '#1E3A8A';
        
        if (performanceClass === 'performance-high') {
          borderColor = '#16a34a';
          feedbackArea.style.background = 'linear-gradient(135deg, #e8f8f5, #d1f2eb)';
        } else if (performanceClass === 'performance-medium') {
          borderColor = '#d97706';
          feedbackArea.style.background = 'linear-gradient(135deg, #fff3cd, #ffeaa7)';
        } else if (performanceClass === 'performance-low') {
          borderColor = '#dc2626';
          feedbackArea.style.background = 'linear-gradient(135deg, #f8d7da, #f5c6cb)';
        }
        
        feedbackArea.style.borderLeftColor = borderColor;
        feedbackArea.innerHTML = `
          ${feedbackTitle ? `<h5 style="color: ${borderColor}">${feedbackTitle}</h5>` : ''}
          ${feedbackContent ? `<p>${feedbackContent}</p>` : ''}
        `;
      }
    });
  });

  // Handle checkbox interactions
  document.querySelectorAll('.simple-checkpoint input[type="checkbox"]').forEach(input => {
    input.addEventListener('change', function() {
      const checkpoint = this.closest('.simple-checkpoint');
      const feedbackArea = checkpoint.querySelector('.feedback-area');
      const checkboxes = checkpoint.querySelectorAll('input[type="checkbox"]');
      const checkedBoxes = checkpoint.querySelectorAll('input[type="checkbox"]:checked');
      
      if (feedbackArea) {
        feedbackArea.classList.add('active');
        
        if (checkedBoxes.length === 0) {
          // No boxes checked - show default
          feedbackArea.style.background = '#f8f9fa';
          feedbackArea.style.borderLeftColor = '#1E3A8A';
          feedbackArea.innerHTML = '<p>Select factors present in your organization to calculate transformation readiness.</p>';
        } else {
          // Calculate readiness score
          const score = Math.round((checkedBoxes.length / checkboxes.length) * 100);
          let scoreColor = '#dc2626'; // Low
          let scoreBackground = 'linear-gradient(135deg, #f8d7da, #f5c6cb)';
          let scoreEmoji = 'ðŸ”§';
          let scoreText = 'Limited readiness';
          
          if (score >= 75) {
            scoreColor = '#16a34a';
            scoreBackground = 'linear-gradient(135deg, #e8f8f5, #d1f2eb)';
            scoreEmoji = 'ðŸš€';
            scoreText = 'High transformation readiness';
          } else if (score >= 50) {
            scoreColor = '#d97706';
            scoreBackground = 'linear-gradient(135deg, #fff3cd, #ffeaa7)';
            scoreEmoji = 'âš¡';
            scoreText = 'Moderate readiness';
          }
          
          feedbackArea.style.background = scoreBackground;
          feedbackArea.style.borderLeftColor = scoreColor;
          feedbackArea.innerHTML = `
            <h5 style="color: ${scoreColor}">${scoreEmoji} Transformation Readiness: ${score}%</h5>
            <p>${scoreText} - ${checkedBoxes.length} of ${checkboxes.length} key factors present.</p>
          `;
        }
      }
    });
  });

  // Handle slider interactions (basic implementation)
  document.querySelectorAll('.slider-track').forEach(track => {
    const thumb = track.querySelector('.slider-thumb');
    let isDragging = false;
    
    track.addEventListener('mousedown', function(e) {
      isDragging = true;
      updateSliderPosition(e, track, thumb);
    });
    
    document.addEventListener('mousemove', function(e) {
      if (isDragging) {
        updateSliderPosition(e, track, thumb);
      }
    });
    
    document.addEventListener('mouseup', function() {
      isDragging = false;
    });
  });
  
  function updateSliderPosition(e, track, thumb) {
    const rect = track.getBoundingClientRect();
    const percentage = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
    thumb.style.left = `${percentage * 100}%`;
    
    // Update feedback based on slider position
    const feedbackId = thumb.dataset.feedbackId;
    if (feedbackId) {
      const feedbackArea = document.getElementById(feedbackId);
      if (feedbackArea) {
        feedbackArea.classList.add('active');
        feedbackArea.innerHTML = `<p>Slider value: ${Math.round(percentage * 100)}%</p>`;
      }
    }
  }
});
</script>